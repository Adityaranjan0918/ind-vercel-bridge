<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AR Trading Terminal | Aditya Ranjan</title>
    <style>
        :root {
            --bg: #0a0e17; --panel: #161b28; --border: #232b3d; --text: #e0e5f0;
            --muted: #75819b; --up: #00c853; --down: #ff3d00; --blue: #0088ff;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); overflow: hidden; display: flex; flex-direction: column; height: 100vh; width: 100vw; }

        /* Top Header */
        header { 
            height: 60px; background: var(--panel); border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between; padding: 0 15px; z-index: 10;
        }
        .asset-selector { background: var(--bg); padding: 8px 15px; border-radius: 6px; border: 1px solid var(--border); font-weight: bold; cursor: pointer; display: flex; gap: 10px; }
        .balance-container { text-align: right; display: flex; align-items: center; gap: 10px; }
        .balance-info small { color: var(--muted); font-size: 0.65rem; text-transform: uppercase; display: block; }
        .balance-info b { color: var(--blue); font-size: 1.1rem; }
        .refresh-btn { background: var(--bg); border: 1px solid var(--border); color: var(--blue); padding: 8px; border-radius: 6px; cursor: pointer; transition: 0.2s; }
        .refresh-btn:hover { background: var(--blue); color: white; }

        /* Main App Area */
        .workspace { flex: 1; display: flex; flex-direction: row; overflow: hidden; position: relative; transition: 0.3s; }
        @media (max-width: 768px) { .workspace { flex-direction: column; } }

        /* Maximize Mode */
        .workspace.chart-maximized .sidebar { display: none !important; }
        .workspace.chart-maximized .trade-panel { display: none !important; }

        /* Left Sidebar (Assets) */
        .sidebar { width: 220px; background: var(--panel); border-right: 1px solid var(--border); overflow-y: auto; display: flex; flex-direction: column; }
        @media (max-width: 768px) { .sidebar { width: 100%; height: 120px; flex-direction: row; border-right: none; border-bottom: 1px solid var(--border); overflow-x: auto; } }
        .asset-cat { padding: 10px 15px; font-size: 0.7rem; color: var(--muted); text-transform: uppercase; background: var(--bg); font-weight: bold; }
        .asset-item { padding: 12px 15px; cursor: pointer; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; transition: 0.2s; }
        .asset-item:hover, .asset-item.active { background: rgba(0, 136, 255, 0.1); border-left: 3px solid var(--blue); }

        /* Chart Area */
        .chart-container { flex: 1; position: relative; background: #000; cursor: crosshair; touch-action: none; }
        canvas { display: block; width: 100%; height: 100%; }
        
        /* Top Left Chart Tools */
        .chart-tools { position: absolute; top: 15px; left: 15px; display: flex; gap: 10px; pointer-events: auto; z-index: 5; flex-wrap: wrap; }
        .tool-select, .btn-expand { background: var(--panel); color: white; border: 1px solid var(--border); padding: 6px 12px; border-radius: 4px; outline: none; cursor: pointer; font-weight: bold; }
        .btn-expand:hover { background: var(--blue); }

        /* Live Price */
        .live-price { position: absolute; top: 60px; left: 15px; pointer-events: none; }
        .live-price h1 { font-size: 2.5rem; font-weight: 800; margin: 0; text-shadow: 0 2px 10px rgba(0,0,0,0.8); }

        /* Copyright AR Branding */
        .branding { position: absolute; bottom: 20px; left: 15px; opacity: 0.3; pointer-events: none; }
        .branding h2 { font-size: 2rem; color: var(--blue); margin: 0; }
        .branding p { font-size: 0.6rem; color: white; }

        /* Right Trading Panel */
        .trade-panel { width: 300px; background: var(--panel); border-left: 1px solid var(--border); display: flex; flex-direction: column; z-index: 10; }
        @media (max-width: 768px) { .trade-panel { width: 100%; height: auto; border-left: none; border-top: 1px solid var(--border); } }

        /* Tab Navigation */
        .panel-tabs { display: flex; background: var(--bg); border-bottom: 1px solid var(--border); }
        .ptab { flex: 1; text-align: center; padding: 12px; font-size: 0.75rem; font-weight: bold; color: var(--muted); cursor: pointer; text-transform: uppercase; }
        .ptab.active { color: var(--blue); border-bottom: 2px solid var(--blue); background: rgba(0,136,255,0.05); }

        .tab-content { display: none; padding: 15px; flex: 1; overflow-y: auto; }
        .tab-content.active { display: block; }

        .trade-mode { display: flex; margin-bottom: 15px; background: var(--bg); border-radius: 6px; overflow: hidden; }
        .trade-mode button { flex: 1; padding: 10px; border: none; background: transparent; color: var(--muted); cursor: pointer; font-weight: bold; }
        .trade-mode button.active { background: var(--blue); color: white; }

        .input-group { margin-bottom: 15px; background: var(--bg); padding: 10px; border-radius: 6px; border: 1px solid var(--border); }
        .input-group label { display: block; font-size: 0.7rem; color: var(--muted); margin-bottom: 5px; }
        .input-group input, .input-group select { width: 100%; background: none; border: none; color: white; font-size: 1.2rem; font-weight: bold; outline: none; }

        .btn-up, .btn-down { width: 100%; padding: 15px; border: none; border-radius: 6px; color: white; font-size: 1.2rem; font-weight: 900; cursor: pointer; margin-bottom: 10px; display: flex; justify-content: space-between; }
        .btn-up { background: var(--up); box-shadow: 0 4px 0 #008c3a; }
        .btn-down { background: var(--down); box-shadow: 0 4px 0 #b32b00; }
        .btn-up:active, .btn-down:active { transform: translateY(4px); box-shadow: none; }

        /* Trades & History List */
        .trade-item { background: var(--bg); padding: 12px; border-radius: 6px; margin-bottom: 10px; border-left: 3px solid var(--blue); font-size: 0.8rem; display: flex; justify-content: space-between; align-items: center; }
        .history-item { background: var(--bg); padding: 12px; border-radius: 6px; margin-bottom: 10px; font-size: 0.8rem; display: flex; justify-content: space-between; align-items: center; }

        /* PnL Popup Screen */
        .popup-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 100;
        }
        .popup-box {
            background: var(--panel); padding: 30px 50px; border-radius: 12px; text-align: center;
            border: 2px solid var(--border); transform: scale(0.8); animation: pop 0.3s forwards;
        }
        @keyframes pop { to { transform: scale(1); } }
        .popup-box h2 { font-size: 1rem; color: var(--muted); margin-bottom: 10px; }
        .popup-box .amt { font-size: 3rem; font-weight: 900; }
        .win-txt { color: var(--up); }
        .loss-txt { color: var(--down); }
    </style>
</head>
<body>

    <header>
        <div class="asset-selector" id="header-asset">
            <span>ðŸ‡ªðŸ‡º EUR/USD</span>
            <span style="color:var(--up)">82%</span>
        </div>
        <div class="balance-container">
            <div class="balance-info">
                <small>AR Live Account</small>
                <b id="balance-txt">$10,000.00</b>
            </div>
            <button class="refresh-btn" onclick="refreshBalance()" title="Reset to $10,000">ðŸ”„</button>
        </div>
    </header>

    <div class="workspace" id="main-workspace">
        <div class="sidebar" id="asset-list">
            </div>

        <div class="chart-container" id="chart-container">
            <div class="chart-tools">
                <button class="btn-expand" onclick="toggleMaximize()">â›¶ Expand</button>
                <select class="tool-select" id="chart-type">
                    <option value="candle">Candles</option>
                    <option value="bar">Bars</option>
                    <option value="line">Line</option>
                </select>
                <select class="tool-select" id="indicator-type">
                    <option value="none">No Indicator</option>
                    <option value="sma">SMA</option>
                    <option value="bb">Bollinger Bands</option>
                </select>
            </div>

            <div class="live-price">
                <h1 id="price-display">0.0000</h1>
            </div>

            <canvas id="arCanvas"></canvas>

            <div class="branding">
                <h2>AR TERMINAL</h2>
                <p>Â© ADITYA RANJAN | TRADE ENGINE</p>
            </div>

            <div class="popup-overlay" id="pnl-popup">
                <div class="popup-box">
                    <h2 id="popup-title">TRADE CLOSED</h2>
                    <div class="amt" id="popup-amt">$0.00</div>
                </div>
            </div>
        </div>

        <div class="trade-panel">
            <div class="panel-tabs">
                <div class="ptab active" onclick="switchTab('trade')">Trade</div>
                <div class="ptab" onclick="switchTab('pos')">Positions</div>
                <div class="ptab" onclick="switchTab('hist')">History</div>
            </div>

            <div id="tab-trade" class="tab-content active">
                <div class="trade-mode">
                    <button class="active">Fixed Time</button>
                </div>

                <div class="input-group">
                    <label>Amount ($)</label>
                    <input type="number" id="t-amount" value="100" min="1">
                </div>
                <div class="input-group">
                    <label>Duration</label>
                    <select id="t-time">
                        <option value="15">15 Seconds</option>
                        <option value="30">30 Seconds</option>
                        <option value="60" selected>1 Minute</option>
                    </select>
                </div>

                <button class="btn-up" id="btn-up">UP â–² <span>82%</span></button>
                <button class="btn-down" id="btn-down">DOWN â–¼ <span>82%</span></button>
            </div>

            <div id="tab-pos" class="tab-content">
                <div id="active-trades-container">
                    <div style="text-align:center; color:var(--muted); margin-top:20px;">No active trades</div>
                </div>
            </div>

            <div id="tab-hist" class="tab-content">
                <div id="history-trades-container">
                    <div style="text-align:center; color:var(--muted); margin-top:20px;">No trading history</div>
                </div>
            </div>
        </div>
    </div>

<script>
    // --- 1. CORE DATA & ASSETS ---
    const assets = {
        'EUR/USD': { type: 'Forex', icon: 'ðŸ‡ªðŸ‡º', price: 1.0845, vol: 0.0002, payout: 0.82, history: [] },
        'GBP/JPY': { type: 'Forex', icon: 'ðŸ‡¬ðŸ‡§', price: 188.30, vol: 0.02, payout: 0.80, history: [] },
        'USD/CAD': { type: 'Forex', icon: 'ðŸ‡ºðŸ‡¸', price: 1.3450, vol: 0.0003, payout: 0.78, history: [] },
        'AAPL': { type: 'Stocks', icon: 'ðŸŽ', price: 173.50, vol: 0.15, payout: 0.85, history: [] },
        'TSLA': { type: 'Stocks', icon: 'âš¡', price: 198.20, vol: 0.40, payout: 0.80, history: [] },
        'BTC/USD': { type: 'Crypto', icon: 'â‚¿', price: 64200.00, vol: 30.0, payout: 0.90, history: [] }
    };

    let currentAsset = 'EUR/USD';
    let balance = 10000.00;
    let activeTrades = [];
    let tradeHistory = [];

    // Pre-generate data
    Object.keys(assets).forEach(key => {
        let p = assets[key].price;
        for(let i=0; i<150; i++) {
            const open = p;
            const close = open + (Math.random() - 0.5) * assets[key].vol * 2;
            const high = Math.max(open, close) + Math.random() * assets[key].vol;
            const low = Math.min(open, close) - Math.random() * assets[key].vol;
            assets[key].history.push({ open, close, high, low });
            p = close;
        }
        assets[key].price = p;
    });

    // Populate Sidebar
    const sidebar = document.getElementById('asset-list');
    let lastType = '';
    Object.keys(assets).forEach(key => {
        if(assets[key].type !== lastType) {
            sidebar.innerHTML += `<div class="asset-cat">${assets[key].type}</div>`;
            lastType = assets[key].type;
        }
        sidebar.innerHTML += `
            <div class="asset-item ${key===currentAsset?'active':''}" onclick="switchAsset('${key}')" id="asset-btn-${key.replace('/','')}">
                <span>${assets[key].icon} ${key}</span>
                <b>${(assets[key].payout*100)}%</b>
            </div>
        `;
    });

    function switchAsset(key) {
        document.querySelectorAll('.asset-item').forEach(el => el.classList.remove('active'));
        document.getElementById(`asset-btn-${key.replace('/','')}`).classList.add('active');
        currentAsset = key;
        document.getElementById('header-asset').innerHTML = `<span>${assets[key].icon} ${key}</span><span style="color:var(--up)">${assets[key].payout*100}%</span>`;
        dragOffset = 0;
    }

    // UI Utilities
    function toggleMaximize() {
        document.getElementById('main-workspace').classList.toggle('chart-maximized');
        setTimeout(() => { canvas.width = document.getElementById('chart-container').offsetWidth; }, 300);
    }

    function refreshBalance() {
        balance = 10000.00;
        updateBalance();
    }

    function switchTab(tabId) {
        document.querySelectorAll('.ptab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        event.target.classList.add('active');
        document.getElementById(`tab-${tabId}`).classList.add('active');
    }

    // --- 2. MARKET ENGINE (Ticks every 1 second) ---
    setInterval(() => {
        Object.keys(assets).forEach(key => {
            const asset = assets[key];
            const open = asset.price;
            const close = open + (Math.random() - 0.5) * asset.vol * 2;
            const high = Math.max(open, close) + Math.random() * asset.vol;
            const low = Math.min(open, close) - Math.random() * asset.vol;
            
            asset.history.push({ open, close, high, low });
            if(asset.history.length > 300) asset.history.shift();
            asset.price = close;

            if(key === currentAsset) {
                const pDisplay = document.getElementById('price-display');
                pDisplay.innerText = close.toFixed(asset.vol < 0.01 ? 4 : 2);
                pDisplay.style.color = close >= open ? 'var(--up)' : 'var(--down)';
            }
        });

        for (let i = activeTrades.length - 1; i >= 0; i--) {
            let t = activeTrades[i];
            t.timeLeft--;
            if (t.timeLeft <= 0) {
                closeTrade(t, i);
            }
        }
        renderActiveTrades();
    }, 1000);

    // --- 3. TRADING LOGIC ---
    document.getElementById('btn-up').onclick = () => placeTrade('UP');
    document.getElementById('btn-down').onclick = () => placeTrade('DOWN');

    function placeTrade(dir) {
        const amt = parseFloat(document.getElementById('t-amount').value);
        const time = parseInt(document.getElementById('t-time').value);
        
        if(amt > balance || amt <= 0) return alert('Insufficient Balance!');
        
        balance -= amt;
        updateBalance();

        activeTrades.push({
            id: Math.floor(Math.random()*10000),
            asset: currentAsset,
            dir: dir,
            entry: assets[currentAsset].price,
            amt: amt,
            timeLeft: time,
            payout: assets[currentAsset].payout
        });
        renderActiveTrades();
        switchTab('pos'); // Auto jump to positions tab
        document.querySelectorAll('.ptab')[1].classList.add('active');
        document.querySelectorAll('.ptab')[0].classList.remove('active');
    }

    function closeTrade(t, index) {
        const currentP = assets[t.asset].price;
        const isWin = (t.dir === 'UP' && currentP > t.entry) || (t.dir === 'DOWN' && currentP < t.entry);
        
        let profit = 0;
        if(isWin) {
            profit = t.amt + (t.amt * t.payout);
            balance += profit;
        }

        activeTrades.splice(index, 1);
        updateBalance();
        
        tradeHistory.unshift({
            ...t,
            status: isWin ? 'WIN' : 'LOSS',
            pnl: isWin ? (t.amt * t.payout) : -t.amt
        });
        
        renderHistoryTrades();
        showPopup(isWin, isWin ? (t.amt * t.payout).toFixed(2) : t.amt.toFixed(2));
    }

    function updateBalance() {
        document.getElementById('balance-txt').innerText = `$${balance.toLocaleString('en-US', {minimumFractionDigits: 2})}`;
    }

    function renderActiveTrades() {
        const box = document.getElementById('active-trades-container');
        if(activeTrades.length === 0) {
            box.innerHTML = '<div style="text-align:center; color:var(--muted); margin-top:20px;">No active trades</div>';
            return;
        }
        box.innerHTML = activeTrades.map(t => `
            <div class="trade-item">
                <div><b>${t.asset}</b> <span style="color:${t.dir==='UP'?'var(--up)':'var(--down)'}">${t.dir}</span><br>Entry: ${t.entry.toFixed(4)}</div>
                <div style="text-align:right"><b>$${t.amt}</b><br><span style="color:var(--blue); font-weight:bold;">${t.timeLeft}s</span></div>
            </div>
        `).join('');
    }

    function renderHistoryTrades() {
        const box = document.getElementById('history-trades-container');
        if(tradeHistory.length === 0) return;
        
        box.innerHTML = tradeHistory.map(t => `
            <div class="history-item" style="border-left: 4px solid ${t.status==='WIN'?'var(--up)':'var(--down)'}">
                <div><b>${t.asset}</b> <br><small>${t.dir} | ${t.status}</small></div>
                <div style="text-align:right; font-weight:bold; color:${t.status==='WIN'?'var(--up)':'var(--down)'}">
                    ${t.status==='WIN'?'+':''}$${t.pnl.toFixed(2)}
                </div>
            </div>
        `).join('');
    }

    function showPopup(isWin, amtStr) {
        const pop = document.getElementById('pnl-popup');
        const amtEl = document.getElementById('popup-amt');
        const titleEl = document.getElementById('popup-title');
        pop.style.display = 'flex';
        titleEl.innerText = isWin ? 'PROFIT SECURED' : 'TRADE LOST';
        amtEl.className = 'amt ' + (isWin ? 'win-txt' : 'loss-txt');
        amtEl.innerText = (isWin ? '+' : '-') + ' $' + amtStr;
        setTimeout(() => { pop.style.display = 'none'; }, 2000);
    }

    // --- 4. CANVAS CHART RENDERING & SWIPE PANNING ---
    const canvas = document.getElementById('arCanvas');
    const ctx = canvas.getContext('2d');
    let dragOffset = 0;
    let isDragging = false;
    let startX = 0;

    // Mouse & Touch Swipe Events
    const startDrag = (e) => { 
        isDragging = true; 
        startX = e.clientX || (e.touches && e.touches[0].clientX); 
    };
    const endDrag = () => { isDragging = false; };
    const moveDrag = (e) => {
        if(!isDragging) return;
        if(e.cancelable) e.preventDefault(); // Prevent screen scroll/refresh on mobile
        let clientX = e.clientX || (e.touches && e.touches[0].clientX);
        dragOffset += (clientX - startX);
        startX = clientX;
    };

    canvas.addEventListener('mousedown', startDrag);
    window.addEventListener('mouseup', endDrag);
    window.addEventListener('mousemove', moveDrag);
    canvas.addEventListener('touchstart', startDrag, {passive: false});
    window.addEventListener('touchend', endDrag);
    canvas.addEventListener('touchmove', moveDrag, {passive: false});

    function drawChart() {
        const container = document.getElementById('chart-container');
        if(canvas.width !== container.offsetWidth) {
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;
        }
        
        const w = canvas.width;
        const h = canvas.height;
        ctx.clearRect(0, 0, w, h);

        const chartType = document.getElementById('chart-type').value;
        const indType = document.getElementById('indicator-type').value;
        const data = assets[currentAsset].history;
        
        const cW = 12;
        const gap = 6;
        const totalW = cW + gap;
        
        const visibleCandles = Math.floor(w / totalW);
        const startIdx = Math.max(0, data.length - visibleCandles - Math.floor(dragOffset / totalW));
        const endIdx = Math.min(data.length, startIdx + visibleCandles + 10);
        const slice = data.slice(startIdx, endIdx);

        if(slice.length === 0) { requestAnimationFrame(drawChart); return; }

        const minP = Math.min(...slice.map(d => d.low)) * 0.999;
        const maxP = Math.max(...slice.map(d => d.high)) * 1.001;
        const range = maxP - minP || 1;

        // Draw Grid
        ctx.strokeStyle = '#1c2230'; ctx.lineWidth = 1;
        for(let i=1; i<5; i++) {
            let y = h - (h/5)*i;
            ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(w, y); ctx.stroke();
        }

        // Indicators
        if(indType === 'sma' && data.length > 20) {
            ctx.strokeStyle = '#ffeb3b'; ctx.lineWidth = 2; ctx.beginPath();
            data.forEach((d, i) => {
                if(i < 20) return;
                const avg = data.slice(i-20, i).reduce((sum, curr) => sum + curr.close, 0) / 20;
                const x = w - (data.length - i) * totalW + dragOffset;
                const y = h - ((avg - minP) / range) * h;
                if(i === 20) ctx.moveTo(x, y); else ctx.lineTo(x, y);
            });
            ctx.stroke();
        }

        if(indType === 'bb' && data.length > 20) {
            ctx.fillStyle = 'rgba(0, 136, 255, 0.1)'; ctx.strokeStyle = 'rgba(0, 136, 255, 0.5)';
            ctx.beginPath();
            let upPts = [], dnPts = [];
            data.forEach((d, i) => {
                if(i < 20) return;
                const period = data.slice(i-20, i);
                const avg = period.reduce((sum, curr) => sum + curr.close, 0) / 20;
                const sd = Math.sqrt(period.map(x => Math.pow(x.close - avg, 2)).reduce((a,b)=>a+b,0)/20);
                const x = w - (data.length - i) * totalW + dragOffset;
                upPts.push({x, y: h - ((avg + sd*2 - minP) / range) * h});
                dnPts.push({x, y: h - ((avg - sd*2 - minP) / range) * h});
            });
            upPts.forEach((p,i) => i===0 ? ctx.moveTo(p.x, p.y) : ctx.lineTo(p.x, p.y));
            dnPts.reverse().forEach(p => ctx.lineTo(p.x, p.y));
            ctx.fill(); ctx.stroke();
        }

        // Draw Price Data
        if(chartType === 'line') {
            ctx.strokeStyle = '#0088ff'; ctx.lineWidth = 3; ctx.beginPath();
            let first = true;
            data.forEach((c, i) => {
                const x = w - (data.length - i) * totalW + dragOffset;
                const y = h - ((c.close - minP) / range) * h;
                if(x > -50 && x < w + 50) {
                    if(first) { ctx.moveTo(x, y); first = false; } else { ctx.lineTo(x, y); }
                }
            });
            ctx.stroke();
        } else {
            // Candles or Bars
            data.forEach((c, i) => {
                const x = w - (data.length - i) * totalW + dragOffset;
                if(x < -20 || x > w + 20) return;

                const isUp = c.close >= c.open;
                const col = isUp ? '#00c853' : '#ff3d00';
                const yO = h - ((c.open - minP) / range) * h;
                const yC = h - ((c.close - minP) / range) * h;
                const yH = h - ((c.high - minP) / range) * h;
                const yL = h - ((c.low - minP) / range) * h;

                ctx.strokeStyle = col; ctx.fillStyle = col;

                if(chartType === 'candle') {
                    ctx.lineWidth = 1.5;
                    ctx.beginPath(); ctx.moveTo(x + cW/2, yH); ctx.lineTo(x + cW/2, yL); ctx.stroke();
                    ctx.fillRect(x, Math.min(yO, yC), cW, Math.max(Math.abs(yO - yC), 2));
                } else if(chartType === 'bar') {
                    ctx.lineWidth = 2;
                    ctx.beginPath(); ctx.moveTo(x + cW/2, yH); ctx.lineTo(x + cW/2, yL); ctx.stroke();
                    ctx.beginPath(); ctx.moveTo(x + cW/2, yO); ctx.lineTo(x, yO); ctx.stroke(); // Open left
                    ctx.beginPath(); ctx.moveTo(x + cW/2, yC); ctx.lineTo(x + cW, yC); ctx.stroke(); // Close right
                }
            });
        }

        // Active Trade Open Lines
        activeTrades.forEach(t => {
            if(t.asset === currentAsset) {
                const yEntry = h - ((t.entry - minP) / range) * h;
                ctx.setLineDash([5, 5]);
                ctx.strokeStyle = t.dir === 'UP' ? '#00c853' : '#ff3d00';
                ctx.lineWidth = 2;
                ctx.beginPath(); ctx.moveTo(0, yEntry); ctx.lineTo(w, yEntry); ctx.stroke();
                
                // Draw Entry Price Bubble
                ctx.setLineDash([]);
                ctx.fillStyle = t.dir === 'UP' ? '#00c853' : '#ff3d00';
                ctx.fillRect(w - 70, yEntry - 10, 70, 20);
                ctx.fillStyle = '#fff'; ctx.font = '10px Arial';
                ctx.fillText(t.entry.toFixed(4), w - 65, yEntry + 3);
            }
        });

        requestAnimationFrame(drawChart);
    }

    // Start UI
    updateBalance();
    drawChart();

</script>
</body>
</html>
